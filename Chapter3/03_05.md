Self Healing: 

Objective: Detect and Respond to Anomalous Behavior in 5G NRF Logs Using Machine Learning

To detect rogue or misbehaving Network Functions (NFs) in a 5G network by analyzing logs generated by the Network Repository Function (NRF) and using machine learning to automate anomaly detection and simulate blocking of malicious IPs.

Step 1 – Upload the NRF Logs
------------------------------------
You uploaded your NRF log file (nrf_bad.log) into Google Colab.

from google.colab import files
uploaded = files.upload()

Think of this as giving the AI a diary of everything that happened in your network.

Step 2 – Parse and Structure Logs
----------------------------------------
You extracted useful information (like IP address, HTTP method, endpoint, status code) from each log entry and turned it into a structured table (a DataFrame).

This step transforms messy text into a clean spreadsheet for AI to understand.

import re
import pandas as pd

log_filename = next(iter(uploaded))
structured_logs = []

with open(log_filename, 'r') as f:
    for line in f:
        match = re.match(r"(\d{4}-\d{2}-\d{2}T[^\s]+)\s\[INFO\]\[NRF\]\[GIN\]\s\|\s(\d{3})\s\|\s([\d\.]+)\s\|\s([A-Z]+)\s\|\s([^|]+)", line)
        if match:
            structured_logs.append({
                "timestamp": match.group(1),
                "status_code": int(match.group(2)),
                "ip": match.group(3),
                "method": match.group(4),
                "endpoint": match.group(5).strip()
            })

df = pd.DataFrame(structured_logs)
df.head()

Step 3 – Create Features
------------------------------
You added "smart columns" that highlight potentially suspicious behavior, like:

Was it a DELETE request?

Did the endpoint contain words like fault or unauthorized?

Was the response status code 500 or 403?

These features are like red flags we want our model to watch for.

# Create features
df['is_fault'] = df['endpoint'].str.contains("fault|unauthorized|error", case=False).astype(int)
df['is_delete'] = (df['method'] == 'DELETE').astype(int)
df['status_5xx'] = (df['status_code'] >= 500).astype(int)
df['status_4xx'] = ((df['status_code'] >= 400) & (df['status_code'] < 500)).astype(int)

# Label known anomalies (manually for training)
df['label'] = (df['is_fault'] | df['is_delete'] | df['status_5xx'] | df['status_4xx']).astype(int)

# View dataset
df[['ip', 'status_code', 'method', 'endpoint', 'is_fault', 'is_delete', 'status_5xx', 'label']]


Step 4 – Train a Machine Learning Model
--------------------------------------------

You trained a Random Forest Classifier — a popular model that learns from past data.
We gave it examples of what’s “normal” vs. “anomalous”, based on our feature flags.

The model learned patterns of bad behavior, like:

Rogue NFs trying to delete other NFs

Accessing unauthorized endpoints

Generating error responses

from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split

features = ['is_fault', 'is_delete', 'status_5xx', 'status_4xx']
X = df[features]
y = df['label']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)

model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

print("✅ Model trained. Accuracy on test set:", model.score(X_test, y_test))


Step 5 – Predict Anomalies
---------------------------------
You used the model to scan all the logs and flag IP addresses that looked suspicious.

These IPs are now identified as potentially rogue NFs.

df['anomaly_pred'] = model.predict(X)

# Show only flagged IPs
anomalies = df[df['anomaly_pred'] == 1]
anomalous_ips = anomalies['ip'].unique()

print("🚨 Anomalous IPs detected by the model:")
for ip in anomalous_ips:
    print(f"🚫 {ip}")

Step 6 – Simulate Blocking
-----------------------------------------
    
You printed simulated firewall commands like:

print("\n🔒 Simulating firewall block for flagged IPs:")
for ip in anomalous_ips:
    print(f"iptables -A INPUT -s {ip} -j DROP  # Simulated block")

